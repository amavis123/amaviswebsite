<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=yes">
  <title>Alex Amavis - Car dealer</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="Alex Amavis - Car dealer">
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#000000">

  <!-- Security Headers -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline' https://storage.googleapis.com https://amavis-voice-api-djyty76xwq-km.a.run.app; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; media-src 'self' https: blob:; connect-src 'self' https://storage.googleapis.com https://amavis-voice-api-djyty76xwq-km.a.run.app https: wss:; frame-src 'self' https://storage.googleapis.com; child-src 'self' https://storage.googleapis.com; object-src 'none'; base-uri 'self'; form-action 'self'">

  <!-- Preconnect for Performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://storage.googleapis.com">
  <link rel="preconnect" href="https://amavis-voice-api-djyty76xwq-km.a.run.app">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">

  <!-- RemixIcon for Modern Icons -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">

  <!-- Favicon -->
  <link rel="icon" type="image/webp" href="assets/images/webp/logos/favicon.webp">

  <!-- Stylesheet -->
  <link rel="stylesheet" href="assets/css/style.css">

  <style>
    .widget-page-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
      color: #ffffff;
    }

    .widget-page-content {
      max-width: 800px;
      width: 100%;
      text-align: center;
    }

    .widget-page-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #ffffff 0%, #cccccc 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .widget-page-description {
      font-size: 1.125rem;
      color: #cccccc;
      margin-bottom: 3rem;
      line-height: 1.6;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: #ffffff;
      text-decoration: none;
      padding: 0.75rem 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-top: 2rem;
    }

    .back-link:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.4);
      transform: translateY(-2px);
    }

    .widget-info {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 2rem;
      margin-top: 3rem;
      text-align: left;
    }

    .widget-info h3 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      color: #ffffff;
    }

    .widget-info p {
      color: #cccccc;
      line-height: 1.6;
      margin-bottom: 0.5rem;
    }

    @media (max-width: 768px) {
      .widget-page-title {
        font-size: 2rem;
      }

      .widget-page-description {
        font-size: 1rem;
      }
    }
  </style>
</head>

<body>
  <div class="widget-page-container">
    <div class="widget-page-content">
      <h1 class="widget-page-title">Agent Alex</h1>
      <p class="widget-page-description">
        This page includes the Alex agent. The agent will appear in the bottom center of the page.
        Click on the "Speak with Alex" button to interact with the agent.
      </p>

      <!-- Vapi Widget will be loaded dynamically after config is available -->
      <div id="vapi-widget-container"></div>

      <!-- Vapi configuration: Injected by Worker if available, otherwise loaded from file -->
      <script>
        // If Worker didn't inject config, load from file (for Cloudflare Pages)
        if (!window.VAPI_CONFIG) {
          const script = document.createElement('script');
          script.src = 'assets/js/vapi-config.js';
          script.onerror = function () {
            console.error('Vapi config not found. For Workers: Set VAPI_ASSISTANT_ID and VAPI_PUBLIC_KEY. For Pages: Upload vapi-config.js to production.');
          };
          document.head.appendChild(script);
        }
      </script>

      <!-- Load Vapi widget SDK -->
      <script src="https://unpkg.com/@vapi-ai/client-sdk-react/dist/embed/widget.umd.js" async
        type="text/javascript"></script>

      <!-- Initialize widget after SDK and config are loaded -->
      <script>
        (function () {
          function initVapiWidget() {
            // Check if config is available
            if (!window.VAPI_CONFIG) {
              console.error('VAPI_CONFIG not found. Make sure vapi-config.js is loaded.');
              return;
            }

            const widgetContainer = document.getElementById('vapi-widget-container');
            if (!widgetContainer) {
              console.error('Vapi widget container not found');
              return;
            }

            // Check if custom element is defined (script has loaded)
            if (!customElements.get('vapi-widget')) {
              // Wait for the script to load and define the custom element
              const script = document.querySelector('script[src*="widget.umd.js"]');
              if (script) {
                script.addEventListener('load', function () {
                  // Give the script a moment to register the custom element
                  setTimeout(initVapiWidget, 100);
                });
              } else {
                // Retry if script tag not found yet
                setTimeout(initVapiWidget, 100);
              }
              return;
            }

            // Create the widget element with secure config
            const widget = document.createElement('vapi-widget');
            widget.setAttribute('assistant-id', window.VAPI_CONFIG.assistantId);
            widget.setAttribute('public-key', window.VAPI_CONFIG.publicKey);

            widgetContainer.appendChild(widget);
          }

          // Start initialization when DOM is ready
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initVapiWidget);
          } else {
            // If config script loads after DOM, wait a bit
            setTimeout(initVapiWidget, 50);
          }
        })();
      </script>
    </div>

</body>

</html>